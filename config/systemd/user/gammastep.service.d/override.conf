[Unit]
After=graphical-session.target
PartOf=graphical-session.target

[Service]
# Ensure Wayland + runtime dir are available to the process
Environment=XDG_RUNTIME_DIR=%t
# Default if import hasn't happened yet (your startup script still imports it)
Environment=WAYLAND_DISPLAY=wayland-0

# Wait until the Wayland socket exists (avoids the race)
ExecStartPre=/usr/bin/sh -lc 'for i in $(seq 1 50); do \
  [ -S "$XDG_RUNTIME_DIR/$WAYLAND_DISPLAY" ] && exit 0; \
  sleep 0.1; \
done; echo "Wayland socket not ready: $XDG_RUNTIME_DIR/$WAYLAND_DISPLAY" >&2; exit 1'

# Use the Wayland backend + a location source
ExecStart=
# ExecStart=/usr/bin/gammastep -m wayland -l geoclue2
ExecStart=/usr/bin/gammastep
# Or fixed coords:
# ExecStart=/usr/bin/gammastep -m wayland -l 51.5074:-0.1278

# Inherit live session vars your startup script exports
PassEnvironment=WAYLAND_DISPLAY DBUS_SESSION_BUS_ADDRESS XDG_SESSION_TYPE XDG_CURRENT_DESKTOP

Restart=on-failure
RestartSec=2s
