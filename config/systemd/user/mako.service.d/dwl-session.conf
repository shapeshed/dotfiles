[Unit]
# Use dwl-session instead of graphical-session
After=dwl-session.target
PartOf=dwl-session.target
BindsTo=dwl-session.target

[Service]
# Ensure runtime dir is available
Environment=XDG_RUNTIME_DIR=%t
# Default Wayland display if import hasn't happened yet
Environment=WAYLAND_DISPLAY=wayland-0

# Wait until the Wayland socket exists (avoids the race)
ExecStartPre=/usr/bin/sh -lc 'for i in $(seq 1 50); do \
  [ -S "$XDG_RUNTIME_DIR/$WAYLAND_DISPLAY" ] && exit 0; \
  sleep 0.1; \
done; echo "Wayland socket not ready: $XDG_RUNTIME_DIR/$WAYLAND_DISPLAY" >&2; exit 1'

# Inherit live session vars your startup script exports
PassEnvironment=WAYLAND_DISPLAY DBUS_SESSION_BUS_ADDRESS XDG_SESSION_TYPE XDG_CURRENT_DESKTOP

# Better restart handling
Restart=on-failure
RestartSec=2s
